# ==========================================
# Local LLM Research Analytics Tool
# Environment Configuration Template
# ==========================================
# Copy this file to .env and fill in your values
# NEVER commit .env to version control
# ==========================================

# ------------------------------------------
# LLM Provider Selection
# ------------------------------------------
# Choose your local LLM provider: "ollama" or "foundry_local"
LLM_PROVIDER=ollama

# ------------------------------------------
# Ollama Configuration
# ------------------------------------------
# Host URL for Ollama server
OLLAMA_HOST=http://localhost:11434

# Model to use for inference (must support tool calling)
# Recommended: qwen2.5:7b-instruct, llama3.1:8b, mistral:7b-instruct
OLLAMA_MODEL=qwen2.5:7b-instruct

# ------------------------------------------
# Microsoft Foundry Local Configuration
# ------------------------------------------
# API endpoint for Foundry Local (default port: 53760)
# Foundry Local uses dynamic ports; check actual port with: foundry service status
FOUNDRY_ENDPOINT=http://127.0.0.1:53760

# Model alias to use (e.g., phi-4, qwen2.5-0.5b, mistral-7b)
FOUNDRY_MODEL=phi-4

# Auto-start Foundry Local using SDK (requires foundry-local-sdk)
# Set to "true" to automatically start the model on agent initialization
FOUNDRY_AUTO_START=false

# ------------------------------------------
# SQL Server Connection
# ------------------------------------------
# SQL Server hostname or IP address
# For Azure SQL: your-server.database.windows.net
SQL_SERVER_HOST=localhost

# SQL Server port (default: 1433)
SQL_SERVER_PORT=1433

# Database name to connect to
SQL_DATABASE_NAME=ResearchAnalytics

# Encrypt connection (required for Azure SQL, recommended for all)
SQL_ENCRYPT=true

# Trust the server certificate (required for self-signed certs)
# Set to false for production Azure SQL connections
SQL_TRUST_SERVER_CERTIFICATE=true

# ------------------------------------------
# SQL Server Authentication
# ------------------------------------------
# Authentication type - choose one of:
#   sql                    - SQL Server authentication (username/password)
#   windows                - Windows integrated authentication
#   azure_ad_interactive   - Azure AD with browser login
#   azure_ad_service_principal - Azure AD with app credentials
#   azure_ad_managed_identity  - Azure Managed Identity (for Azure-hosted apps)
#   azure_ad_default       - Azure DefaultAzureCredential (auto-detect)
#
SQL_AUTH_TYPE=sql

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Option 1: SQL Server Authentication
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Standard username/password authentication
# Use this for local SQL Server or Docker containers
#
# SQL_AUTH_TYPE=sql
SQL_USERNAME=sa
SQL_PASSWORD=LocalLLM@2024!

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Option 2: Windows Authentication
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Uses current Windows credentials (integrated security)
# Leave SQL_USERNAME and SQL_PASSWORD empty
#
# SQL_AUTH_TYPE=windows
# SQL_USERNAME=
# SQL_PASSWORD=

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Option 3: Azure AD Interactive
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Opens browser for Azure AD login
# Best for development and interactive use
#
# SQL_AUTH_TYPE=azure_ad_interactive
# SQL_USERNAME=
# SQL_PASSWORD=

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Option 4: Azure AD Service Principal
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Uses Azure application credentials
# Best for automated/unattended scenarios
#
# SQL_AUTH_TYPE=azure_ad_service_principal
# AZURE_TENANT_ID=your-tenant-id-guid
# AZURE_CLIENT_ID=your-app-client-id-guid
# AZURE_CLIENT_SECRET=your-client-secret

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Option 5: Azure Managed Identity
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Uses Azure Managed Identity (system or user-assigned)
# Best for Azure-hosted applications (VMs, App Service, Functions)
#
# SQL_AUTH_TYPE=azure_ad_managed_identity
# AZURE_CLIENT_ID=                    # Optional: for user-assigned MI only

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Option 6: Azure AD Default Credential
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Auto-detects available Azure credentials in order:
# 1. Environment variables (AZURE_CLIENT_ID, etc.)
# 2. Managed Identity
# 3. Azure CLI (az login)
# 4. Azure PowerShell
# 5. Interactive browser
#
# SQL_AUTH_TYPE=azure_ad_default

# ------------------------------------------
# Azure AD Configuration
# ------------------------------------------
# Required for service principal authentication
# Optional for managed identity (user-assigned only)
AZURE_TENANT_ID=
AZURE_CLIENT_ID=
AZURE_CLIENT_SECRET=

# ------------------------------------------
# Docker SQL Server Configuration
# ------------------------------------------
# Password for SQL Server SA account in Docker
# IMPORTANT: Change this for production!
MSSQL_SA_PASSWORD=LocalLLM@2024!

# ------------------------------------------
# Docker Volume Configuration
# ------------------------------------------
# Named volumes for data persistence
# These volumes preserve data when containers are rebuilt
# Default names match existing volumes from previous setup
MSSQL_VOLUME_NAME=local-llm-mssql-data
BACKEND_VOLUME_NAME=local-llm-backend-data
REDIS_VOLUME_NAME=local-llm-redis-data

# ==========================================
# SQL Server 2025 Backend Database
# ==========================================
# The backend database stores application state, configuration,
# and vector embeddings using SQL Server 2025's native VECTOR type.
# This separates app data from sample demo data (ResearchAnalytics).

# ------------------------------------------
# Backend Database Connection
# ------------------------------------------
# SQL Server 2025 hostname (Docker: mssql-backend, Local: localhost)
BACKEND_DB_HOST=localhost

# Backend database port (default: 1434 to avoid conflict with sample DB)
BACKEND_DB_PORT=1434

# Backend database name (stores app state + vectors)
BACKEND_DB_NAME=LLM_BackEnd

# Backend database credentials (defaults to SQL_USERNAME/SQL_PASSWORD if empty)
BACKEND_DB_USERNAME=
BACKEND_DB_PASSWORD=

# Trust self-signed certificates for backend
BACKEND_DB_TRUST_CERT=true

# ------------------------------------------
# Vector Store Configuration
# ------------------------------------------
# Vector store type: "mssql" (SQL Server 2025) or "redis" (Redis Stack)
# SQL Server 2025 uses native VECTOR type - no external dependencies
# Redis is available as fallback for environments without SQL Server 2025
VECTOR_STORE_TYPE=mssql

# Embedding dimensions (768 for nomic-embed-text, 384 for all-MiniLM-L6-v2)
VECTOR_DIMENSIONS=768

# ------------------------------------------
# MSSQL MCP Server Configuration
# ------------------------------------------
# Path to the MSSQL MCP Server index.js file
# After cloning and building: SQL-AI-samples/MssqlMcp/Node/dist/index.js
#
# Windows example:
# MCP_MSSQL_PATH=C:\Projects\SQL-AI-samples\MssqlMcp\Node\dist\index.js
#
# Linux/Mac example:
# MCP_MSSQL_PATH=/home/user/SQL-AI-samples/MssqlMcp/Node/dist/index.js

MCP_MSSQL_PATH=

# Set to "true" for read-only mode (safer for exploration)
MCP_MSSQL_READONLY=false

# Enable MCP server debug logging
MCP_DEBUG=false

# ------------------------------------------
# Response Caching
# ------------------------------------------
# Enable caching of LLM responses for repeated queries
CACHE_ENABLED=true

# Maximum number of cached responses
CACHE_MAX_SIZE=100

# Cache time-to-live in seconds (0 = no expiration)
# Default: 3600 (1 hour)
CACHE_TTL_SECONDS=3600

# ------------------------------------------
# Rate Limiting
# ------------------------------------------
# Enable rate limiting for LLM API calls
RATE_LIMIT_ENABLED=false

# Maximum requests per minute
RATE_LIMIT_RPM=60

# Maximum burst size (requests allowed before throttling)
RATE_LIMIT_BURST=10

# ------------------------------------------
# Application Configuration
# ------------------------------------------
# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Streamlit server port
STREAMLIT_PORT=8501

# Enable debug mode (more verbose output)
DEBUG=false

# ==========================================
# Backend Infrastructure & RAG
# ==========================================

# ------------------------------------------
# Redis Configuration
# ------------------------------------------
# Redis connection URL for vector store
REDIS_URL=redis://localhost:6379

# Redis server port (default: 6379)
REDIS_PORT=6379

# RedisInsight GUI port (default: 8001)
# Change this if port 8001 is already in use on your system
REDIS_INSIGHT_PORT=8008

# ------------------------------------------
# Embedding Configuration
# ------------------------------------------
# Ollama model for generating embeddings
# Recommended: nomic-embed-text (768 dimensions)
EMBEDDING_MODEL=nomic-embed-text

# ------------------------------------------
# RAG Configuration
# ------------------------------------------
# Document chunk size for RAG (characters)
CHUNK_SIZE=500

# Overlap between consecutive chunks
CHUNK_OVERLAP=50

# Number of chunks to retrieve for RAG queries
RAG_TOP_K=5

# ------------------------------------------
# Storage Configuration
# ------------------------------------------
# Directory for uploaded documents
UPLOAD_DIR=./data/uploads

# Maximum file upload size in MB
MAX_UPLOAD_SIZE_MB=100

# ------------------------------------------
# API Server Configuration
# ------------------------------------------
# API server bind address
API_HOST=0.0.0.0

# API server port
API_PORT=8000

# Path to MCP server configuration file
MCP_CONFIG_PATH=mcp_config.json

# ==========================================
# Apache Superset BI Platform
# ==========================================

# ------------------------------------------
# Superset Configuration
# ------------------------------------------
# URL for the Superset service (internal or external)
SUPERSET_URL=http://localhost:8088

# Secret key for Superset sessions (generate with: openssl rand -base64 42)
# IMPORTANT: Change this for production!
SUPERSET_SECRET_KEY=localllm_default_secret_key_change_me_in_production

# Admin credentials for Superset
SUPERSET_ADMIN_USER=admin
SUPERSET_ADMIN_PASSWORD=LocalLLM@2024!

# Superset web UI port
SUPERSET_PORT=8088

# Volume name for Superset data persistence
SUPERSET_VOLUME_NAME=local-llm-superset-data


# ==========================================
# JWT Authentication
# ==========================================

# ------------------------------------------
# JWT Token Configuration
# ------------------------------------------
# Secret key for signing JWT tokens
# CRITICAL: Generate a secure key for production!
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
JWT_SECRET_KEY=your-super-secret-key-change-in-production

# Access token expiration in minutes (default: 30)
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# Refresh token expiration in days (default: 7)
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7


# ==========================================
# Quick Start Examples
# ==========================================
#
# Example 1: Local Docker SQL Server
# ----------------------------------
# SQL_SERVER_HOST=localhost
# SQL_DATABASE_NAME=ResearchAnalytics
# SQL_AUTH_TYPE=sql
# SQL_USERNAME=sa
# SQL_PASSWORD=LocalLLM@2024!
# SQL_TRUST_SERVER_CERTIFICATE=true
#
# Example 2: On-Premises SQL Server (Windows Auth)
# ------------------------------------------------
# SQL_SERVER_HOST=sqlserver.company.local
# SQL_DATABASE_NAME=Analytics
# SQL_AUTH_TYPE=windows
# SQL_TRUST_SERVER_CERTIFICATE=true
#
# Example 3: Azure SQL Database (Interactive)
# -------------------------------------------
# SQL_SERVER_HOST=myserver.database.windows.net
# SQL_DATABASE_NAME=mydb
# SQL_AUTH_TYPE=azure_ad_interactive
# SQL_ENCRYPT=true
# SQL_TRUST_SERVER_CERTIFICATE=false
#
# Example 4: Azure SQL Database (Service Principal)
# -------------------------------------------------
# SQL_SERVER_HOST=myserver.database.windows.net
# SQL_DATABASE_NAME=mydb
# SQL_AUTH_TYPE=azure_ad_service_principal
# AZURE_TENANT_ID=12345678-1234-1234-1234-123456789abc
# AZURE_CLIENT_ID=87654321-4321-4321-4321-cba987654321
# AZURE_CLIENT_SECRET=your-secret-here
# SQL_ENCRYPT=true
# SQL_TRUST_SERVER_CERTIFICATE=false
#
# Example 5: Azure VM with Managed Identity
# -----------------------------------------
# SQL_SERVER_HOST=myserver.database.windows.net
# SQL_DATABASE_NAME=mydb
# SQL_AUTH_TYPE=azure_ad_managed_identity
# SQL_ENCRYPT=true
# SQL_TRUST_SERVER_CERTIFICATE=false
#
# ==========================================
